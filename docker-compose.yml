postgresql:
  restart: always
  image: sameersbn/postgresql:9.4-19
  environment:
    - DB_USER=gitlab
    - DB_PASS=password
    - DB_NAME=gitlabhq_production
    - DB_EXTENSION=pg_trgm
  volumes:
    - /srv/docker/gitlab/postgresql:/var/lib/postgresql
gitlab:
  restart: always
  image: leftathome/gitlab-ee:tlsoptions
  links:
    - redis:redisio
    - postgresql:postgresql
  ports:
    - "10080:80"
    - "10022:22"
  environment:
    DEBUG: 'false'
    TZ: Asia/Kolkata
    GITLAB_TIMEZONE: Kolkata

    GITLAB_SECRETS_DB_KEY_BASE: long-and-random-alphanumeric-string

    GITLAB_HOST: localhost
    GITLAB_PORT: 10080
    GITLAB_SSH_PORT: 10022
    GITLAB_RELATIVE_URL_ROOT: 

    GITLAB_NOTIFY_ON_BROKEN_BUILDS: 'true'
    GITLAB_NOTIFY_PUSHER: 'false'

    GITLAB_EMAIL: notifications@example.com
    GITLAB_EMAIL_REPLY_TO: noreply@example.com
    GITLAB_INCOMING_EMAIL_ADDRESS: reply@example.com
    GITLAB_BACKUP_SCHEDULE: daily
    GITLAB_BACKUP_TIME: 01:00

    LDAP_ENABLED: 'true'
    LDAP_HOST: idp.disney.com
    LDAP_METHOD: ssl
    LDAP_TLSOPTIONS: '\{ verify_mode\: OpenSSL::SSL::VERIFY_NONE \}'
    LDAP_PORT: 2636
    LDAP_UID: uid
    LDAP_BIND_DN: "uid=WDI-techstudios, ou=apps, o=local"
    LDAP_PASS: 'z8p-=2-=%*V+c-6-!|2Y'
    LDAP_LABEL: 'HUB ID'
    LDAP_ACTIVE_DIRECTORY: 'true'
    LDAP_BASE: 'ou=uid,ou=id,dc=disney,dc=com'
    LDAP_USER_FILTER: '(objectClass=person)'
  volumes:
    - /srv/docker/gitlab/gitlab:/home/git/data
redis:
  restart: always
  image: sameersbn/redis:latest
  volumes:
    - /srv/docker/gitlab/redis:/var/lib/redis
